"use strict";(self.webpackChunkgorm=self.webpackChunkgorm||[]).push([[7018],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),u=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(i.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=u(t),d=a,N=m["".concat(i,".").concat(d)]||m[d]||c[d]||s;return t?r.createElement(N,o(o({ref:n},p),{},{components:t})):r.createElement(N,o({ref:n},p))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,o=new Array(s);o[0]=m;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var u=2;u<s;u++)o[u]=t[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2649:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return i},default:function(){return d},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return c}});var r=t(7462),a=t(3366),s=(t(7294),t(3905)),o=["components"],l={title:"\u521b\u5efa",layout:"page"},i=void 0,u={unversionedId:"create",id:"create",title:"\u521b\u5efa",description:"\u521b\u5efa\u8bb0\u5f55",source:"@site/docs/create.md",sourceDirName:".",slug:"/create",permalink:"/gorm/docs/create",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/create.md",tags:[],version:"current",frontMatter:{title:"\u521b\u5efa",layout:"page"},sidebar:"tutorialSidebar",previous:{title:"\u7ea6\u5b9a",permalink:"/gorm/docs/conventions"},next:{title:"\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b",permalink:"/gorm/docs/data_types"}},p={},c=[{value:"\u521b\u5efa\u8bb0\u5f55",id:"\u521b\u5efa\u8bb0\u5f55",level:2},{value:"\u7528\u6307\u5b9a\u7684\u5b57\u6bb5\u521b\u5efa\u8bb0\u5f55",id:"\u7528\u6307\u5b9a\u7684\u5b57\u6bb5\u521b\u5efa\u8bb0\u5f55",level:2},{value:'<span id="batch_insert">\u6279\u91cf\u63d2\u5165</span>',id:"\u6279\u91cf\u63d2\u5165",level:2},{value:"\u521b\u5efa\u94a9\u5b50",id:"\u521b\u5efa\u94a9\u5b50",level:2},{value:"\u6839\u636e Map \u521b\u5efa",id:"\u6839\u636e-map-\u521b\u5efa",level:2},{value:'<span id="create_from_sql_expr">\u4f7f\u7528 SQL \u8868\u8fbe\u5f0f\u3001Context Valuer \u521b\u5efa\u8bb0\u5f55</span>',id:"\u4f7f\u7528-sql-\u8868\u8fbe\u5f0fcontext-valuer-\u521b\u5efa\u8bb0\u5f55",level:2},{value:"\u9ad8\u7ea7\u9009\u9879",id:"\u9ad8\u7ea7\u9009\u9879",level:2},{value:'<span id="create_with_associations">\u5173\u8054\u521b\u5efa</span>',id:"\u5173\u8054\u521b\u5efa",level:3},{value:'<span id="default_values">\u9ed8\u8ba4\u503c</span>',id:"\u9ed8\u8ba4\u503c",level:3},{value:'<span id="upsert">Upsert \u53ca\u51b2\u7a81</span>',id:"upsert-\u53ca\u51b2\u7a81",level:3}],m={toc:c};function d(e){var n=e.components,t=(0,a.Z)(e,o);return(0,s.kt)("wrapper",(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"\u521b\u5efa\u8bb0\u5f55"},"\u521b\u5efa\u8bb0\u5f55"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'user := User{Name: "Jinzhu", Age: 18, Birthday: time.Now()}\n\nresult := db.Create(&user) // \u901a\u8fc7\u6570\u636e\u7684\u6307\u9488\u6765\u521b\u5efa\n\nuser.ID             // \u8fd4\u56de\u63d2\u5165\u6570\u636e\u7684\u4e3b\u952e\nresult.Error        // \u8fd4\u56de error\nresult.RowsAffected // \u8fd4\u56de\u63d2\u5165\u8bb0\u5f55\u7684\u6761\u6570\n')),(0,s.kt)("h2",{id:"\u7528\u6307\u5b9a\u7684\u5b57\u6bb5\u521b\u5efa\u8bb0\u5f55"},"\u7528\u6307\u5b9a\u7684\u5b57\u6bb5\u521b\u5efa\u8bb0\u5f55"),(0,s.kt)("p",null,"\u521b\u5efa\u8bb0\u5f55\u5e76\u66f4\u65b0\u7ed9\u51fa\u7684\u5b57\u6bb5\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'db.Select("Name", "Age", "CreatedAt").Create(&user)\n// INSERT INTO `users` (`name`,`age`,`created_at`) VALUES ("jinzhu", 18, "2020-07-04 11:05:21.775")\n')),(0,s.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u8bb0\u5f55\u4e14\u4e00\u540c\u5ffd\u7565\u4f20\u9012\u7ed9\u7565\u53bb\u7684\u5b57\u6bb5\u503c\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'db.Omit("Name", "Age", "CreatedAt").Create(&user)\n// INSERT INTO `users` (`birthday`,`updated_at`) VALUES ("2020-01-01 00:00:00.000", "2020-07-04 11:05:21.775")\n')),(0,s.kt)("h2",{id:"\u6279\u91cf\u63d2\u5165"},(0,s.kt)("span",{id:"batch_insert"},"\u6279\u91cf\u63d2\u5165")),(0,s.kt)("p",null,"\u8981\u6709\u6548\u5730\u63d2\u5165\u5927\u91cf\u8bb0\u5f55\uff0c\u8bf7\u5c06\u4e00\u4e2a ",(0,s.kt)("inlineCode",{parentName:"p"},"slice")," \u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"Create")," \u65b9\u6cd5\u3002 GORM \u5c06\u751f\u6210\u5355\u72ec\u4e00\u6761SQL\u8bed\u53e5\u6765\u63d2\u5165\u6240\u6709\u6570\u636e\uff0c\u5e76\u56de\u586b\u4e3b\u952e\u7684\u503c\uff0c\u94a9\u5b50\u65b9\u6cd5\u4e5f\u4f1a\u88ab\u8c03\u7528\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'var users = []User{{Name: "jinzhu1"}, {Name: "jinzhu2"}, {Name: "jinzhu3"}}\ndb.Create(&users)\n\nfor _, user := range users {\n  user.ID // 1,2,3\n}\n')),(0,s.kt)("p",null,"\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"CreateInBatches")," \u5206\u6279\u521b\u5efa\u65f6\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u6bcf\u6279\u7684\u6570\u91cf\uff0c\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'var users = []User{{name: "jinzhu_1"}, ...., {Name: "jinzhu_10000"}}\n\n// \u6570\u91cf\u4e3a 100\ndb.CreateInBatches(users, 100)\n')),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"#upsert"},"Upsert")," \u548c ",(0,s.kt)("a",{parentName:"p",href:"#create_with_associations"},"Create With Associations")," \u4e5f\u652f\u6301\u6279\u91cf\u63d2\u5165"),(0,s.kt)("p",null,"{% note warn %}\n",(0,s.kt)("strong",{parentName:"p"},"\u6ce8\u610f")," \u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"p"},"CreateBatchSize")," \u9009\u9879\u521d\u59cb\u5316 GORM \u65f6\uff0c\u6240\u6709\u7684\u521b\u5efa& \u5173\u8054 ",(0,s.kt)("inlineCode",{parentName:"p"},"INSERT")," \u90fd\u5c06\u9075\u5faa\u8be5\u9009\u9879\n{% endnote %}"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'db, err := gorm.Open(sqlite.Open("gorm.db"), &gorm.Config{\n  CreateBatchSize: 1000,\n})\n\ndb := db.Session(&gorm.Session{CreateBatchSize: 1000})\n\nusers = [5000]User{{Name: "jinzhu", Pets: []Pet{pet1, pet2, pet3}}...}\n\ndb.Create(&users)\n// INSERT INTO users xxx (5 batches)\n// INSERT INTO pets xxx (15 batches)\n')),(0,s.kt)("h2",{id:"\u521b\u5efa\u94a9\u5b50"},"\u521b\u5efa\u94a9\u5b50"),(0,s.kt)("p",null,"GORM \u5141\u8bb8\u7528\u6237\u5b9a\u4e49\u7684\u94a9\u5b50\u6709 ",(0,s.kt)("inlineCode",{parentName:"p"},"BeforeSave"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"BeforeCreate"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"AfterSave"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"AfterCreate"),"  \u521b\u5efa\u8bb0\u5f55\u65f6\u5c06\u8c03\u7528\u8fd9\u4e9b\u94a9\u5b50\u65b9\u6cd5\uff0c\u8bf7\u53c2\u8003 ",(0,s.kt)("a",{parentName:"p",href:"hooks.html"},"Hooks")," \u4e2d\u5173\u4e8e\u751f\u547d\u5468\u671f\u7684\u8be6\u7ec6\u4fe1\u606f"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'func (u *User) BeforeCreate(tx *gorm.DB) (err error) {\n  u.UUID = uuid.New()\n\n    if u.Role == "admin" {\n        return errors.New("invalid role")\n    }\n    return\n}\n')),(0,s.kt)("p",null,"\u5982\u679c\u60a8\u60f3\u8df3\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"\u94a9\u5b50")," \u65b9\u6cd5\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"SkipHooks")," \u4f1a\u8bdd\u6a21\u5f0f\uff0c\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},"DB.Session(&gorm.Session{SkipHooks: true}).Create(&user)\n\nDB.Session(&gorm.Session{SkipHooks: true}).Create(&users)\n\nDB.Session(&gorm.Session{SkipHooks: true}).CreateInBatches(users, 100)\n")),(0,s.kt)("h2",{id:"\u6839\u636e-map-\u521b\u5efa"},"\u6839\u636e Map \u521b\u5efa"),(0,s.kt)("p",null,"GORM \u652f\u6301\u6839\u636e ",(0,s.kt)("inlineCode",{parentName:"p"},"map[string]interface{}")," \u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"[]map[string]interface{}{}")," \u521b\u5efa\u8bb0\u5f55\uff0c\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'db.Model(&User{}).Create(map[string]interface{}{\n  "Name": "jinzhu", "Age": 18,\n})\n\n// batch insert from `[]map[string]interface{}{}`\ndb.Model(&User{}).Create([]map[string]interface{}{\n  {"Name": "jinzhu_1", "Age": 18},\n  {"Name": "jinzhu_2", "Age": 20},\n})\n')),(0,s.kt)("p",null,"{% note warn %}\n",(0,s.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a")," \u6839\u636e map \u521b\u5efa\u8bb0\u5f55\u65f6\uff0cassociation \u4e0d\u4f1a\u88ab\u8c03\u7528\uff0c\u4e14\u4e3b\u952e\u4e5f\u4e0d\u4f1a\u81ea\u52a8\u586b\u5145\n{% endnote %}"),(0,s.kt)("h2",{id:"\u4f7f\u7528-sql-\u8868\u8fbe\u5f0fcontext-valuer-\u521b\u5efa\u8bb0\u5f55"},(0,s.kt)("span",{id:"create_from_sql_expr"},"\u4f7f\u7528 SQL \u8868\u8fbe\u5f0f\u3001Context Valuer \u521b\u5efa\u8bb0\u5f55")),(0,s.kt)("p",null,"GORM \u5141\u8bb8\u4f7f\u7528 SQL \u8868\u8fbe\u5f0f\u63d2\u5165\u6570\u636e\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u6807\u3002\u6839\u636e ",(0,s.kt)("inlineCode",{parentName:"p"},"map[string]interface{}")," \u6216 ",(0,s.kt)("a",{parentName:"p",href:"data_types.html#gorm_valuer_interface"},"\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b")," \u521b\u5efa\uff0c\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'// \u901a\u8fc7 map \u521b\u5efa\u8bb0\u5f55\ndb.Model(User{}).Create(map[string]interface{}{\n  "Name": "jinzhu",\n  "Location": clause.Expr{SQL: "ST_PointFromText(?)", Vars: []interface{}{"POINT(100 100)"}},\n})\n// INSERT INTO `users` (`name`,`location`) VALUES ("jinzhu",ST_PointFromText("POINT(100 100)"));\n\n// \u901a\u8fc7\u81ea\u5b9a\u4e49\u7c7b\u578b\u521b\u5efa\u8bb0\u5f55\ntype Location struct {\n    X, Y int\n}\n\n// Scan \u65b9\u6cd5\u5b9e\u73b0\u4e86 sql.Scanner \u63a5\u53e3\nfunc (loc *Location) Scan(v interface{}) error {\n  // Scan a value into struct from database driver\n}\n\nfunc (loc Location) GormDataType() string {\n  return "geometry"\n}\n\nfunc (loc Location) GormValue(ctx context.Context, db *gorm.DB) clause.Expr {\n  return clause.Expr{\n    SQL:  "ST_PointFromText(?)",\n    Vars: []interface{}{fmt.Sprintf("POINT(%d %d)", loc.X, loc.Y)},\n  }\n}\n\ntype User struct {\n  Name     string\n  Location Location\n}\n\ndb.Create(&User{\n  Name:     "jinzhu",\n  Location: Location{X: 100, Y: 100},\n})\n// INSERT INTO `users` (`name`,`location`) VALUES ("jinzhu",ST_PointFromText("POINT(100 100)"))\n')),(0,s.kt)("h2",{id:"\u9ad8\u7ea7\u9009\u9879"},"\u9ad8\u7ea7\u9009\u9879"),(0,s.kt)("h3",{id:"\u5173\u8054\u521b\u5efa"},(0,s.kt)("span",{id:"create_with_associations"},"\u5173\u8054\u521b\u5efa")),(0,s.kt)("p",null,"\u521b\u5efa\u5173\u8054\u6570\u636e\u65f6\uff0c\u5982\u679c\u5173\u8054\u503c\u662f\u975e\u96f6\u503c\uff0c\u8fd9\u4e9b\u5173\u8054\u4f1a\u88ab upsert\uff0c\u4e14\u5b83\u4eec\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"Hook")," \u65b9\u6cd5\u4e5f\u4f1a\u88ab\u8c03\u7528"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'type CreditCard struct {\n  gorm.Model\n  Number   string\n  UserID   uint\n}\n\ntype User struct {\n  gorm.Model\n  Name       string\n  CreditCard CreditCard\n}\n\ndb.Create(&User{\n  Name: "jinzhu",\n  CreditCard: CreditCard{Number: "411111111111"}\n})\n// INSERT INTO `users` ...\n// INSERT INTO `credit_cards` ...\n')),(0,s.kt)("p",null,"\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"Select"),"\u3001 ",(0,s.kt)("inlineCode",{parentName:"p"},"Omit")," \u8df3\u8fc7\u5173\u8054\u4fdd\u5b58\uff0c\u4f8b\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'db.Omit("CreditCard").Create(&user)\n\n// \u8df3\u8fc7\u6240\u6709\u5173\u8054\ndb.Omit(clause.Associations).Create(&user)\n')),(0,s.kt)("h3",{id:"\u9ed8\u8ba4\u503c"},(0,s.kt)("span",{id:"default_values"},"\u9ed8\u8ba4\u503c")),(0,s.kt)("p",null,"\u60a8\u53ef\u4ee5\u901a\u8fc7\u6807\u7b7e ",(0,s.kt)("inlineCode",{parentName:"p"},"default")," \u4e3a\u5b57\u6bb5\u5b9a\u4e49\u9ed8\u8ba4\u503c\uff0c\u5982\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'type User struct {\n  ID   int64\n  Name string `gorm:"default:galeone"`\n  Age  int64  `gorm:"default:18"`\n}\n')),(0,s.kt)("p",null,"\u63d2\u5165\u8bb0\u5f55\u5230\u6570\u636e\u5e93\u65f6\uff0c\u9ed8\u8ba4\u503c ",(0,s.kt)("em",{parentName:"p"},"\u4f1a\u88ab\u7528\u4e8e")," \u586b\u5145\u503c\u4e3a ",(0,s.kt)("a",{parentName:"p",href:"https://tour.golang.org/basics/12"},"\u96f6\u503c")," \u7684\u5b57\u6bb5"),(0,s.kt)("p",null,"{% note warn %}\n",(0,s.kt)("strong",{parentName:"p"},"\u6ce8\u610f")," \u5bf9\u4e8e\u58f0\u660e\u4e86\u9ed8\u8ba4\u503c\u7684\u5b57\u6bb5\uff0c\u50cf ",(0,s.kt)("inlineCode",{parentName:"p"},"0"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"''"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"false")," \u7b49\u96f6\u503c\u662f\u4e0d\u4f1a\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u3002\u60a8\u9700\u8981\u4f7f\u7528\u6307\u9488\u7c7b\u578b\u6216 Scanner/Valuer \u6765\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f8b\u5982\uff1a\n{% endnote %}"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'type User struct {\n  gorm.Model\n  Name string\n  Age  *int           `gorm:"default:18"`\n  Active sql.NullBool `gorm:"default:true"`\n}\n')),(0,s.kt)("p",null,"{% note warn %}\n",(0,s.kt)("strong",{parentName:"p"},"\u6ce8\u610f")," \u82e5\u8981\u6570\u636e\u5e93\u6709\u9ed8\u8ba4\u3001\u865a\u62df/\u751f\u6210\u7684\u503c\uff0c\u4f60\u5fc5\u987b\u4e3a\u5b57\u6bb5\u8bbe\u7f6e ",(0,s.kt)("inlineCode",{parentName:"p"},"default")," \u6807\u7b7e\u3002\u82e5\u8981\u5728\u8fc1\u79fb\u65f6\u8df3\u8fc7\u9ed8\u8ba4\u503c\u5b9a\u4e49\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"default:(-)"),"\uff0c\u4f8b\u5982\uff1a\n{% endnote %}"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'type User struct {\n  ID        string `gorm:"default:uuid_generate_v3()"` // db func\n  FirstName string\n  LastName  string\n  Age       uint8\n  FullName  string `gorm:"->;type:GENERATED ALWAYS AS (concat(firstname,\' \',lastname));default:(-);"`\n}\n')),(0,s.kt)("p",null,"\u4f7f\u7528\u865a\u62df/\u751f\u6210\u7684\u503c\u65f6\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u7981\u7528\u5b83\u7684\u521b\u5efa\u3001\u66f4\u65b0\u6743\u9650\uff0c\u67e5\u770b ",(0,s.kt)("a",{parentName:"p",href:"models.html#field_permission"},"\u5b57\u6bb5\u7ea7\u6743\u9650")," \u83b7\u53d6\u8be6\u60c5"),(0,s.kt)("h3",{id:"upsert-\u53ca\u51b2\u7a81"},(0,s.kt)("span",{id:"upsert"},"Upsert \u53ca\u51b2\u7a81")),(0,s.kt)("p",null,"GORM \u4e3a\u4e0d\u540c\u6570\u636e\u5e93\u63d0\u4f9b\u4e86\u517c\u5bb9\u7684 Upsert \u652f\u6301"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},'import "gorm.io/gorm/clause"\n\n// \u5728\u51b2\u7a81\u65f6\uff0c\u4ec0\u4e48\u90fd\u4e0d\u505a\ndb.Clauses(clause.OnConflict{DoNothing: true}).Create(&user)\n\n// \u5728`id`\u51b2\u7a81\u65f6\uff0c\u5c06\u5217\u66f4\u65b0\u4e3a\u9ed8\u8ba4\u503c\ndb.Clauses(clause.OnConflict{\n  Columns:   []clause.Column{{Name: "id"}},\n  DoUpdates: clause.Assignments(map[string]interface{}{"role": "user"}),\n}).Create(&users)\n// MERGE INTO "users" USING *** WHEN NOT MATCHED THEN INSERT *** WHEN MATCHED THEN UPDATE SET ***; SQL Server\n// INSERT INTO `users` *** ON DUPLICATE KEY UPDATE ***; MySQL\n\n// \u4f7f\u7528SQL\u8bed\u53e5\ndb.Clauses(clause.OnConflict{\n  Columns:   []clause.Column{{Name: "id"}},\n  DoUpdates: clause.Assignments(map[string]interface{}{"count": gorm.Expr("GREATEST(count, VALUES(count))")}),\n}).Create(&users)\n// INSERT INTO `users` *** ON DUPLICATE KEY UPDATE `count`=GREATEST(count, VALUES(count));\n\n// \u5728`id`\u51b2\u7a81\u65f6\uff0c\u5c06\u5217\u66f4\u65b0\u4e3a\u65b0\u503c\ndb.Clauses(clause.OnConflict{\n  Columns:   []clause.Column{{Name: "id"}},\n  DoUpdates: clause.AssignmentColumns([]string{"name", "age"}),\n}).Create(&users)\n// MERGE INTO "users" USING *** WHEN NOT MATCHED THEN INSERT *** WHEN MATCHED THEN UPDATE SET "name"="excluded"."name"; SQL Server\n// INSERT INTO "users" *** ON CONFLICT ("id") DO UPDATE SET "name"="excluded"."name", "age"="excluded"."age"; PostgreSQL\n// INSERT INTO `users` *** ON DUPLICATE KEY UPDATE `name`=VALUES(name),`age=VALUES(age); MySQL\n\n// \u5728\u51b2\u7a81\u65f6\uff0c\u66f4\u65b0\u9664\u4e3b\u952e\u4ee5\u5916\u7684\u6240\u6709\u5217\u5230\u65b0\u503c\u3002\ndb.Clauses(clause.OnConflict{\n  UpdateAll: true,\n}).Create(&users)\n// INSERT INTO "users" *** ON CONFLICT ("id") DO UPDATE SET "name"="excluded"."name", "age"="excluded"."age", ...;\n')),(0,s.kt)("p",null,"\u60a8\u8fd8\u53ef\u4ee5\u67e5\u770b ",(0,s.kt)("a",{parentName:"p",href:"advanced_query.html"},"\u9ad8\u7ea7\u67e5\u8be2")," \u4e2d\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"FirstOrInit"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"FirstOrCreate")),(0,s.kt)("p",null,"\u67e5\u770b ",(0,s.kt)("a",{parentName:"p",href:"sql_builder.html"},"\u539f\u751f SQL \u53ca\u6784\u9020\u5668")," \u83b7\u53d6\u66f4\u591a\u7ec6\u8282"))}d.isMDXComponent=!0}}]);