"use strict";(self.webpackChunkgorm=self.webpackChunkgorm||[]).push([[4350],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return c}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),d=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=d(n),c=r,g=m["".concat(p,".").concat(c)]||m[c]||s[c]||l;return n?a.createElement(g,i(i({ref:t},u),{},{components:n})):a.createElement(g,i({ref:t},u))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var d=2;d<l;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6388:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return c},frontMatter:function(){return o},metadata:function(){return d},toc:function(){return s}});var a=n(7462),r=n(3366),l=(n(7294),n(3905)),i=["components"],o={title:"\u7ea6\u5b9a",layout:"page"},p=void 0,d={unversionedId:"conventions",id:"conventions",title:"\u7ea6\u5b9a",description:"\u4f7f\u7528 ID \u4f5c\u4e3a\u4e3b\u952e",source:"@site/docs/conventions.md",sourceDirName:".",slug:"/conventions",permalink:"/gorm/docs/conventions",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/conventions.md",tags:[],version:"current",frontMatter:{title:"\u7ea6\u5b9a",layout:"page"},sidebar:"tutorialSidebar",previous:{title:"Context",permalink:"/gorm/docs/context"},next:{title:"\u521b\u5efa",permalink:"/gorm/docs/create"}},u={},s=[{value:"\u4f7f\u7528 <code>ID</code> \u4f5c\u4e3a\u4e3b\u952e",id:"\u4f7f\u7528-id-\u4f5c\u4e3a\u4e3b\u952e",level:2},{value:"\u590d\u6570\u8868\u540d",id:"\u590d\u6570\u8868\u540d",level:2},{value:"TableName",id:"tablename",level:3},{value:"\u4e34\u65f6\u6307\u5b9a\u8868\u540d",id:"\u4e34\u65f6\u6307\u5b9a\u8868\u540d",level:3},{value:'<span id="naming_strategy">\u547d\u540d\u7b56\u7565</span>',id:"\u547d\u540d\u7b56\u7565",level:3},{value:"\u5217\u540d",id:"\u5217\u540d",level:2},{value:"\u65f6\u95f4\u6233\u8ffd\u8e2a",id:"\u65f6\u95f4\u6233\u8ffd\u8e2a",level:2},{value:"CreatedAt",id:"createdat",level:3},{value:"UpdatedAt",id:"updatedat",level:3}],m={toc:s};function c(e){var t=e.components,n=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u4f7f\u7528-id-\u4f5c\u4e3a\u4e3b\u952e"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"h2"},"ID")," \u4f5c\u4e3a\u4e3b\u952e"),(0,l.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cGORM \u4f1a\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"ID")," \u4f5c\u4e3a\u8868\u7684\u4e3b\u952e\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"type User struct {\n\xa0 ID \xa0 string // \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u540d\u4e3a `ID` \u7684\u5b57\u6bb5\u4f1a\u4f5c\u4e3a\u8868\u7684\u4e3b\u952e\n\xa0 Name string\n}\n")),(0,l.kt)("p",null,"\u4f60\u53ef\u4ee5\u901a\u8fc7\u6807\u7b7e ",(0,l.kt)("inlineCode",{parentName:"p"},"primaryKey")," \u5c06\u5176\u5b83\u5b57\u6bb5\u8bbe\u4e3a\u4e3b\u952e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'// \u5c06 `UUID` \u8bbe\u4e3a\u4e3b\u952e\ntype Animal struct {\n\xa0 ID \xa0 \xa0 int64\n\xa0 UUID \xa0 string `gorm:"primaryKey"`\n\xa0 Name \xa0 string\n\xa0 Age \xa0 \xa0int64\n}\n')),(0,l.kt)("p",null,"\u6b64\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u770b\u770b ",(0,l.kt)("a",{parentName:"p",href:"composite_primary_key.html"},"\u590d\u5408\u4e3b\u952e")),(0,l.kt)("h2",{id:"\u590d\u6570\u8868\u540d"},"\u590d\u6570\u8868\u540d"),(0,l.kt)("p",null,"GORM \u4f7f\u7528\u7ed3\u6784\u4f53\u540d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"\u86c7\u5f62\u547d\u540d")," \u4f5c\u4e3a\u8868\u540d\u3002\u5bf9\u4e8e\u7ed3\u6784\u4f53 ",(0,l.kt)("inlineCode",{parentName:"p"},"User"),"\uff0c\u6839\u636e\u7ea6\u5b9a\uff0c\u5176\u8868\u540d\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"users")),(0,l.kt)("h3",{id:"tablename"},"TableName"),(0,l.kt)("p",null,"\u60a8\u53ef\u4ee5\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"Tabler")," \u63a5\u53e3\u6765\u66f4\u6539\u9ed8\u8ba4\u8868\u540d\uff0c\u4f8b\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'type Tabler interface {\n    TableName() string\n}\n\n// TableName \u4f1a\u5c06 User \u7684\u8868\u540d\u91cd\u5199\u4e3a `profiles`\nfunc (User) TableName() string {\n\xa0 return "profiles"\n}\n')),(0,l.kt)("p",null,"{% note warn %}\n",(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a")," ",(0,l.kt)("inlineCode",{parentName:"p"},"TableName")," \u4e0d\u652f\u6301\u52a8\u6001\u53d8\u5316\uff0c\u5b83\u4f1a\u88ab\u7f13\u5b58\u4e0b\u6765\u4ee5\u4fbf\u540e\u7eed\u4f7f\u7528\u3002\u60f3\u8981\u4f7f\u7528\u52a8\u6001\u8868\u540d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"Scopes"),"\uff0c\u4f8b\u5982\uff1a\n{% endnote %}"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'func UserTable(user User) func (tx *gorm.DB) *gorm.DB {\n  return func (tx *gorm.DB) *gorm.DB {\n    if user.Admin {\n      return tx.Table("admin_users")\n    }\n\n    return tx.Table("users")\n  }\n}\n\ndb.Scopes(UserTable(user)).Create(&user)\n')),(0,l.kt)("h3",{id:"\u4e34\u65f6\u6307\u5b9a\u8868\u540d"},"\u4e34\u65f6\u6307\u5b9a\u8868\u540d"),(0,l.kt)("p",null,"\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"Table")," \u65b9\u6cd5\u4e34\u65f6\u6307\u5b9a\u8868\u540d\uff0c\u4f8b\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'// \u6839\u636e User \u7684\u5b57\u6bb5\u521b\u5efa `deleted_users` \u8868\ndb.Table("deleted_users").AutoMigrate(&User{})\n\n// \u4ece\u53e6\u4e00\u5f20\u8868\u67e5\u8be2\u6570\u636e\nvar deletedUsers []User\ndb.Table("deleted_users").Find(&deletedUsers)\n// SELECT * FROM deleted_users;\n\ndb.Table("deleted_users").Where("name = ?", "jinzhu").Delete(&User{})\n// DELETE FROM deleted_users WHERE name = \'jinzhu\';\n')),(0,l.kt)("p",null,"\u67e5\u770b ",(0,l.kt)("a",{parentName:"p",href:"advanced_query.html#from_subquery"},"from \u5b50\u67e5\u8be2")," \u4e86\u89e3\u5982\u4f55\u5728 FROM \u5b50\u53e5\u4e2d\u4f7f\u7528\u5b50\u67e5\u8be2"),(0,l.kt)("h3",{id:"\u547d\u540d\u7b56\u7565"},(0,l.kt)("span",{id:"naming_strategy"},"\u547d\u540d\u7b56\u7565")),(0,l.kt)("p",null,"GORM \u5141\u8bb8\u7528\u6237\u901a\u8fc7\u8986\u76d6\u9ed8\u8ba4\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"\u547d\u540d\u7b56\u7565"),"\u66f4\u6539\u9ed8\u8ba4\u7684\u547d\u540d\u7ea6\u5b9a\uff0c\u547d\u540d\u7b56\u7565\u88ab\u7528\u4e8e\u6784\u5efa\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"TableName"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"ColumnName"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"JoinTableName"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"RelationshipFKName"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"CheckerName"),"\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"IndexName"),"\u3002\u67e5\u770b ",(0,l.kt)("a",{parentName:"p",href:"gorm_config.html#naming_strategy"},"GORM \u914d\u7f6e")," \u83b7\u53d6\u8be6\u60c5"),(0,l.kt)("h2",{id:"\u5217\u540d"},"\u5217\u540d"),(0,l.kt)("p",null,"\u6839\u636e\u7ea6\u5b9a\uff0c\u6570\u636e\u8868\u7684\u5217\u540d\u4f7f\u7528\u7684\u662f struct \u5b57\u6bb5\u540d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"\u86c7\u5f62\u547d\u540d")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},"type User struct {\n\xa0 ID \xa0 \xa0 \xa0 \xa0uint \xa0 \xa0 \xa0// \u5217\u540d\u662f `id`\n\xa0 Name \xa0 \xa0 \xa0string \xa0 \xa0// \u5217\u540d\u662f `name`\n\xa0 Birthday \xa0time.Time // \u5217\u540d\u662f `birthday`\n\xa0 CreatedAt time.Time // \u5217\u540d\u662f `created_at`\n}\n")),(0,l.kt)("p",null,"\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"column")," \u6807\u7b7e\u6216 ",(0,l.kt)("a",{parentName:"p",href:"#naming_strategy"},(0,l.kt)("inlineCode",{parentName:"a"},"\u547d\u540d\u7b56\u7565"))," \u6765\u8986\u76d6\u5217\u540d"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'type Animal struct {\n\xa0 AnimalID int64 \xa0 \xa0 `gorm:"column:beast_id"` \xa0 \xa0 \xa0 \xa0 // \u5c06\u5217\u540d\u8bbe\u4e3a `beast_id`\n\xa0 Birthday time.Time `gorm:"column:day_of_the_beast"` // \u5c06\u5217\u540d\u8bbe\u4e3a `day_of_the_beast`\n\xa0 Age \xa0 \xa0 \xa0int64 \xa0 \xa0 `gorm:"column:age_of_the_beast"` // \u5c06\u5217\u540d\u8bbe\u4e3a `age_of_the_beast`\n}\n')),(0,l.kt)("h2",{id:"\u65f6\u95f4\u6233\u8ffd\u8e2a"},"\u65f6\u95f4\u6233\u8ffd\u8e2a"),(0,l.kt)("h3",{id:"createdat"},"CreatedAt"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"CreatedAt")," \u5b57\u6bb5\u7684\u6a21\u578b\uff0c\u521b\u5efa\u8bb0\u5f55\u65f6\uff0c\u5982\u679c\u8be5\u5b57\u6bb5\u503c\u4e3a\u96f6\u503c\uff0c\u5219\u5c06\u8be5\u5b57\u6bb5\u7684\u503c\u8bbe\u4e3a\u5f53\u524d\u65f6\u95f4"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'db.Create(&user) // \u5c06 `CreatedAt` \u8bbe\u4e3a\u5f53\u524d\u65f6\u95f4\n\nuser2 := User{Name: "jinzhu", CreatedAt: time.Now()}\ndb.Create(&user2) // user2 \u7684 `CreatedAt` \u4e0d\u4f1a\u88ab\u4fee\u6539\n\n// \u60f3\u8981\u4fee\u6539\u8be5\u503c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 `Update`\ndb.Model(&user).Update("CreatedAt", time.Now())\n')),(0,l.kt)("p",null,"You can disable the timestamp tracking by setting ",(0,l.kt)("inlineCode",{parentName:"p"},"autoCreateTime")," tag to ",(0,l.kt)("inlineCode",{parentName:"p"},"false"),", for example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'type User struct {\n  CreatedAt time.Time `gorm:"autoCreateTime:false"`\n}\n')),(0,l.kt)("h3",{id:"updatedat"},"UpdatedAt"),(0,l.kt)("p",null,"For models having ",(0,l.kt)("inlineCode",{parentName:"p"},"UpdatedAt")," field, the field will be set to the current time when the record is updated or created if its value is zero"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'db.Save(&user) // set `UpdatedAt` to current time\n\ndb.Model(&user).Update("name", "jinzhu") // will set `UpdatedAt` to current time\n\ndb.Model(&user).UpdateColumn("name", "jinzhu") // `UpdatedAt` won\'t be changed\n\nuser2 := User{Name: "jinzhu", UpdatedAt: time.Now()}\ndb.Create(&user2) // user2\'s `UpdatedAt` won\'t be changed when creating\n\nuser3 := User{Name: "jinzhu", UpdatedAt: time.Now()}\ndb.Save(&user3) // user3\'s `UpdatedAt` will change to current time when updating\n')),(0,l.kt)("p",null,"You can disable the timestamp tracking by setting ",(0,l.kt)("inlineCode",{parentName:"p"},"autoUpdateTime")," tag to ",(0,l.kt)("inlineCode",{parentName:"p"},"false"),", for example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'type User struct {\n  UpdatedAt time.Time `gorm:"autoUpdateTime:false"`\n}\n')),(0,l.kt)("p",null,"{% note %}\n",(0,l.kt)("strong",{parentName:"p"},"NOTE")," GORM supports having multiple time tracking fields and track with UNIX (nano/milli) seconds, checkout ",(0,l.kt)("a",{parentName:"p",href:"models.html#time_tracking"},"Models")," for more details\n{% endnote %}"))}c.isMDXComponent=!0}}]);