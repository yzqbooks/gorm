"use strict";(self.webpackChunkgorm=self.webpackChunkgorm||[]).push([[2483],{3905:function(e,r,n){n.d(r,{Zo:function(){return p},kt:function(){return c}});var t=n(7294);function o(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function s(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){o(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function i(e,r){if(null==e)return{};var n,t,o=function(e,r){if(null==e)return{};var n,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||(o[n]=e[n]);return o}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=t.createContext({}),m=function(e){var r=t.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):s(s({},r),e)),n},p=function(e){var r=m(e.components);return t.createElement(l.Provider,{value:r},e.children)},g={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},u=t.forwardRef((function(e,r){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=m(n),c=o,d=u["".concat(l,".").concat(c)]||u[c]||g[c]||a;return n?t.createElement(d,s(s({ref:r},p),{},{components:n})):t.createElement(d,s({ref:r},p))}));function c(e,r){var n=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=u;var i={};for(var l in r)hasOwnProperty.call(r,l)&&(i[l]=r[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var m=2;m<a;m++)s[m]=n[m];return t.createElement.apply(null,s)}return t.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3450:function(e,r,n){n.r(r),n.d(r,{assets:function(){return p},contentTitle:function(){return l},default:function(){return c},frontMatter:function(){return i},metadata:function(){return m},toc:function(){return g}});var t=n(7462),o=n(3366),a=(n(7294),n(3905)),s=["components"],i={title:"\u8fde\u63a5\u5230\u6570\u636e\u5e93",layout:"page"},l=void 0,m={unversionedId:"connecting_to_the_database",id:"connecting_to_the_database",title:"\u8fde\u63a5\u5230\u6570\u636e\u5e93",description:"GORM \u5b98\u65b9\u652f\u6301\u7684\u6570\u636e\u5e93\u7c7b\u578b\u6709\uff1a MySQL, PostgreSQL, SQlite, SQL Server",source:"@site/docs/connecting_to_the_database.md",sourceDirName:".",slug:"/connecting_to_the_database",permalink:"/gorm/docs/connecting_to_the_database",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/connecting_to_the_database.md",tags:[],version:"current",frontMatter:{title:"\u8fde\u63a5\u5230\u6570\u636e\u5e93",layout:"page"},sidebar:"tutorialSidebar",previous:{title:"\u590d\u5408\u4e3b\u952e",permalink:"/gorm/docs/composite_primary_key"},next:{title:"\u7ea6\u675f",permalink:"/gorm/docs/constraints"}},p={},g=[{value:"MySQL",id:"mysql",level:2},{value:"\u81ea\u5b9a\u4e49\u9a71\u52a8",id:"\u81ea\u5b9a\u4e49\u9a71\u52a8",level:3},{value:"\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5",id:"\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5",level:3},{value:"PostgreSQL",id:"postgresql",level:2},{value:"\u81ea\u5b9a\u4e49\u9a71\u52a8",id:"\u81ea\u5b9a\u4e49\u9a71\u52a8-1",level:3},{value:"\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5",id:"\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5-1",level:3},{value:"SQLite",id:"sqlite",level:2},{value:"SQL Server",id:"sql-server",level:2},{value:"Clickhouse",id:"clickhouse",level:2},{value:"\u8fde\u63a5\u6c60",id:"\u8fde\u63a5\u6c60",level:2},{value:"\u4e0d\u652f\u6301\u7684\u6570\u636e\u5e93",id:"\u4e0d\u652f\u6301\u7684\u6570\u636e\u5e93",level:2}],u={toc:g};function c(e){var r=e.components,n=(0,o.Z)(e,s);return(0,a.kt)("wrapper",(0,t.Z)({},u,n,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"GORM \u5b98\u65b9\u652f\u6301\u7684\u6570\u636e\u5e93\u7c7b\u578b\u6709\uff1a MySQL, PostgreSQL, SQlite, SQL Server"),(0,a.kt)("h2",{id:"mysql"},"MySQL"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  "gorm.io/driver/mysql"\n  "gorm.io/gorm"\n)\n\nfunc main() {\n  // \u53c2\u8003 https://github.com/go-sql-driver/mysql#dsn-data-source-name \u83b7\u53d6\u8be6\u60c5\n  dsn := "user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local"\n  db, err := gorm.Open(mysql.Open(dsn), &gorm.Config{})\n}\n')),(0,a.kt)("p",null,"{% note warn %}\n",(0,a.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a"),"\u60f3\u8981\u6b63\u786e\u7684\u5904\u7406 ",(0,a.kt)("inlineCode",{parentName:"p"},"time.Time")," \uff0c\u60a8\u9700\u8981\u5e26\u4e0a ",(0,a.kt)("inlineCode",{parentName:"p"},"parseTime")," \u53c2\u6570\uff0c (",(0,a.kt)("a",{parentName:"p",href:"https://github.com/go-sql-driver/mysql#parameters"},"\u66f4\u591a\u53c2\u6570"),") \u8981\u652f\u6301\u5b8c\u6574\u7684 UTF-8 \u7f16\u7801\uff0c\u60a8\u9700\u8981\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"charset=utf8")," \u66f4\u6539\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"charset=utf8mb4")," \u67e5\u770b ",(0,a.kt)("a",{parentName:"p",href:"https://mathiasbynens.be/notes/mysql-utf8mb4"},"\u6b64\u6587\u7ae0")," \u83b7\u53d6\u8be6\u60c5\n{% endnote %}"),(0,a.kt)("p",null,"MySQl \u9a71\u52a8\u7a0b\u5e8f\u63d0\u4f9b\u4e86 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/go-gorm/mysql"},"\u4e00\u4e9b\u9ad8\u7ea7\u914d\u7f6e")," \u53ef\u4ee5\u5728\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u4f7f\u7528\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'db, err := gorm.Open(mysql.New(mysql.Config{\n  DSN: "gorm:gorm@tcp(127.0.0.1:3306)/gorm?charset=utf8&parseTime=True&loc=Local", // DSN data source name\n  DefaultStringSize: 256, // string \u7c7b\u578b\u5b57\u6bb5\u7684\u9ed8\u8ba4\u957f\u5ea6\n  DisableDatetimePrecision: true, // \u7981\u7528 datetime \u7cbe\u5ea6\uff0cMySQL 5.6 \u4e4b\u524d\u7684\u6570\u636e\u5e93\u4e0d\u652f\u6301\n  DontSupportRenameIndex: true, // \u91cd\u547d\u540d\u7d22\u5f15\u65f6\u91c7\u7528\u5220\u9664\u5e76\u65b0\u5efa\u7684\u65b9\u5f0f\uff0cMySQL 5.7 \u4e4b\u524d\u7684\u6570\u636e\u5e93\u548c MariaDB \u4e0d\u652f\u6301\u91cd\u547d\u540d\u7d22\u5f15\n  DontSupportRenameColumn: true, // \u7528 `change` \u91cd\u547d\u540d\u5217\uff0cMySQL 8 \u4e4b\u524d\u7684\u6570\u636e\u5e93\u548c MariaDB \u4e0d\u652f\u6301\u91cd\u547d\u540d\u5217\n  SkipInitializeWithVersion: false, // \u6839\u636e\u5f53\u524d MySQL \u7248\u672c\u81ea\u52a8\u914d\u7f6e\n}), &gorm.Config{})\n')),(0,a.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u9a71\u52a8"},"\u81ea\u5b9a\u4e49\u9a71\u52a8"),(0,a.kt)("p",null,"GORM \u5141\u8bb8\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"DriverName")," \u9009\u9879\u81ea\u5b9a\u4e49 MySQL \u9a71\u52a8\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  _ "example.com/my_mysql_driver"\n  "gorm.io/gorm"\n)\n\ndb, err := gorm.Open(mysql.New(mysql.Config{\n  DriverName: "my_mysql_driver",\n  DSN: "gorm:gorm@tcp(localhost:9910)/gorm?charset=utf8&parseTime=True&loc=Local", // Data Source Name\uff0c\u53c2\u8003 https://github.com/go-sql-driver/mysql#dsn-data-source-name\n}), &gorm.Config{})\n')),(0,a.kt)("h3",{id:"\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5"},"\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5"),(0,a.kt)("p",null,"GORM \u5141\u8bb8\u901a\u8fc7\u4e00\u4e2a\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5\u6765\u521d\u59cb\u5316 ",(0,a.kt)("inlineCode",{parentName:"p"},"*gorm.DB")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  "database/sql"\n  "gorm.io/driver/mysql"\n  "gorm.io/gorm"\n)\n\nsqlDB, err := sql.Open("mysql", "mydb_dsn")\ngormDB, err := gorm.Open(mysql.New(mysql.Config{\n  Conn: sqlDB,\n}), &gorm.Config{})\n')),(0,a.kt)("h2",{id:"postgresql"},"PostgreSQL"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  "gorm.io/driver/postgres"\n  "gorm.io/gorm"\n)\n\ndsn := "host=localhost user=gorm password=gorm dbname=gorm port=9920 sslmode=disable TimeZone=Asia/Shanghai"\ndb, err := gorm.Open(postgres.Open(dsn), &gorm.Config{})\n')),(0,a.kt)("p",null,"\u6211\u4eec\u4f7f\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/jackc/pgx"},"pgx")," \u4f5c\u4e3a postgres \u7684 database/sql \u9a71\u52a8\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b83\u4f1a\u542f\u7528 prepared statement \u7f13\u5b58\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u7981\u7528\u5b83\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'// https://github.com/go-gorm/postgres\ndb, err := gorm.Open(postgres.New(postgres.Config{\n  DSN: "user=gorm password=gorm dbname=gorm port=9920 sslmode=disable TimeZone=Asia/Shanghai",\n  PreferSimpleProtocol: true, // disables implicit prepared statement usage\n}), &gorm.Config{})\n')),(0,a.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u9a71\u52a8-1"},"\u81ea\u5b9a\u4e49\u9a71\u52a8"),(0,a.kt)("p",null,"GORM \u5141\u8bb8\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"DriverName")," \u9009\u9879\u81ea\u5b9a\u4e49 PostgreSQL \u9a71\u52a8\uff0c\u4f8b\u5982\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  _ "github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/postgres"\n  "gorm.io/gorm"\n)\n\ndb, err := gorm.Open(postgres.New(postgres.Config{\n  DriverName: "cloudsqlpostgres",\n  DSN: "host=project:region:instance user=postgres dbname=postgres password=password sslmode=disable",\n})\n')),(0,a.kt)("h3",{id:"\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5-1"},"\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5"),(0,a.kt)("p",null,"GORM \u5141\u8bb8\u901a\u8fc7\u4e00\u4e2a\u73b0\u6709\u7684\u6570\u636e\u5e93\u8fde\u63a5\u6765\u521d\u59cb\u5316 ",(0,a.kt)("inlineCode",{parentName:"p"},"*gorm.DB")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  "database/sql"\n  "gorm.io/driver/postgres"\n  "gorm.io/gorm"\n)\n\nsqlDB, err := sql.Open("pgx", "mydb_dsn")\ngormDB, err := gorm.Open(postgres.New(postgres.Config{\n  Conn: sqlDB,\n}), &gorm.Config{})\n')),(0,a.kt)("h2",{id:"sqlite"},"SQLite"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  "gorm.io/driver/sqlite" // Sqlite driver based on GGO\n  // "github.com/glebarez/sqlite" // Pure go SQLite driver, checkout https://github.com/glebarez/sqlite for details\n  "gorm.io/gorm"\n)\n\n// github.com/mattn/go-sqlite3\ndb, err := gorm.Open(sqlite.Open("gorm.db"), &gorm.Config{})\n')),(0,a.kt)("p",null,"{% note warn %}\n",(0,a.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a")," \u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"file::memory:?cache=shared")," \u66ff\u4ee3\u6587\u4ef6\u8def\u5f84\u3002 \u8fd9\u4f1a\u544a\u8bc9 SQLite \u5728\u7cfb\u7edf\u5185\u5b58\u4e2d\u4f7f\u7528\u4e00\u4e2a\u4e34\u65f6\u6570\u636e\u5e93\u3002 (\u67e5\u770b ",(0,a.kt)("a",{parentName:"p",href:"https://www.sqlite.org/inmemorydb.html"},"SQLite \u6587\u6863")," \u83b7\u53d6\u8be6\u60c5)\n{% endnote %}"),(0,a.kt)("h2",{id:"sql-server"},"SQL Server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  "gorm.io/driver/sqlserver"\n  "gorm.io/gorm"\n)\n\n// github.com/denisenkom/go-mssqldb\ndsn := "sqlserver://gorm:LoremIpsum86@localhost:9930?database=gorm"\ndb, err := gorm.Open(sqlserver.Open(dsn), &gorm.Config{})\n')),(0,a.kt)("h2",{id:"clickhouse"},"Clickhouse"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/go-gorm/clickhouse"},"https://github.com/go-gorm/clickhouse")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import (\n  "gorm.io/driver/clickhouse"\n  "gorm.io/gorm"\n)\n\nfunc main() {\n  dsn := "tcp://localhost:9000?database=gorm&username=gorm&password=gorm&read_timeout=10&write_timeout=20"\n  db, err := gorm.Open(clickhouse.Open(dsn), &gorm.Config{})\n\n  // Auto Migrate\n  db.AutoMigrate(&User{})\n  // Set table options\n  db.Set("gorm:table_options", "ENGINE=Distributed(cluster, default, hits)").AutoMigrate(&User{})\n\n  // \u63d2\u5165\n  db.Create(&user)\n\n  // \u67e5\u8be2\n  db.Find(&user, "id = ?", 10)\n\n  // \u6279\u91cf\u63d2\u5165\n  var users = []User{user1, user2, user3}\n  db.Create(&users)\n  // ...\n}\n')),(0,a.kt)("h2",{id:"\u8fde\u63a5\u6c60"},"\u8fde\u63a5\u6c60"),(0,a.kt)("p",null,"GORM \u4f7f\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://pkg.go.dev/database/sql"},"database/sql")," \u7ef4\u62a4\u8fde\u63a5\u6c60"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"sqlDB, err := db.DB()\n\n// SetMaxIdleConns \u8bbe\u7f6e\u7a7a\u95f2\u8fde\u63a5\u6c60\u4e2d\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\nsqlDB.SetMaxIdleConns(10)\n\n// SetMaxOpenConns \u8bbe\u7f6e\u6253\u5f00\u6570\u636e\u5e93\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\u3002\nsqlDB.SetMaxOpenConns(100)\n\n// SetConnMaxLifetime \u8bbe\u7f6e\u4e86\u8fde\u63a5\u53ef\u590d\u7528\u7684\u6700\u5927\u65f6\u95f4\u3002\nsqlDB.SetConnMaxLifetime(time.Hour)\n")),(0,a.kt)("p",null,"\u67e5\u770b ",(0,a.kt)("a",{parentName:"p",href:"generic_interface.html"},"\u901a\u7528\u63a5\u53e3")," \u83b7\u53d6\u8be6\u60c5\u3002"),(0,a.kt)("h2",{id:"\u4e0d\u652f\u6301\u7684\u6570\u636e\u5e93"},"\u4e0d\u652f\u6301\u7684\u6570\u636e\u5e93"),(0,a.kt)("p",null,"\u6709\u4e9b\u6570\u636e\u5e93\u53ef\u80fd\u517c\u5bb9 ",(0,a.kt)("inlineCode",{parentName:"p"},"mysql"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"postgres")," \u7684\u65b9\u8a00\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\u5e93\u7684\u65b9\u8a00\u3002"),(0,a.kt)("p",null,"\u5bf9\u4e8e\u5176\u5b83\u4e0d\u652f\u6301\u7684\u6570\u636e\uff0c",(0,a.kt)("a",{parentName:"p",href:"write_driver.html"},"\u6211\u4eec\u9f13\u52b1\u4e14\u6b22\u8fce\u5927\u5bb6\u4f19\u5f00\u53d1\u66f4\u591a\u6570\u636e\u5e93\u7c7b\u578b\u7684\u9a71\u52a8\uff01")))}c.isMDXComponent=!0}}]);